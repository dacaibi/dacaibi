<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title></title>
        <style>
            /*css reset*/
            body,
            p,
            h1 {
                margin: 0;
            }

            h1 {
                font-weight: normal;
                font-size: 16px;
            }

            ul {
                margin: 0;
                padding: 0;
                list-style: none;
            }

            input {
                padding: 0;
                margin: 0;
                outline: none;
            }

            a {
                text-decoration: none;
            }

            /*public css*/
            html, body {
                width: 100%;
                height: 100%;
                font-family: arial, "宋体";
                background: url(../images/bg1.jpg) no-repeat;
                background-size: 100% 100%;
                overflow: hidden;
                display: flex;
                justify-content: center;
                align-items: center;
            }

            .wrap {
                /*position: absolute;*/
                position: relative;
                width: 950px;
                height: 523px;
                background-color: #ffffff;
            }

            .clear {
                zoom: 1;
            }

            .clear:after {
                content: '';
                display: block;
                clear: both;
            }

            .left {
                float: left;
            }

            /*header css*/
            .head {
                height: 60px;
                background-color: #e5ecf2;
            }

            .head h1 {
                padding-top: 4px;
                width: 165px;
                background-color: #e15671;
                font-size: 12px;
                line-height: 54px;
                color: #fff;
            }

            .head h1 a {
                width: 48px;
                height: 20px;
                float: right;
                line-height: 56px;
                color: #fff;
            }

            .head .logo {
                float: left;
                margin: 17px 8px 19px 20px;
                width: 84px;
                background: url(../images/logo-2.png) no-repeat;
                background-size: 84px auto;
            }

            .head nav {
                padding: 4px 14px 0;
                line-height: 56px;
                color: #505051;
            }

            .head nav a {
                padding: 0 18px;
                color: #505051;
            }

            .hint1 {
                margin: 18px 13px 14px;
                width: 354px;
                height: 26px;
                background: url(../images/hint1.jpg) no-repeat;
            }

            .hint2 {
                margin: 18px 7px 14px;
                width: 124px;
                height: 26px;
                background: url(../images/hint2.jpg) no-repeat;
            }

            /*section css*/
            .fuList {
                width: 165px;
                height: 464px;
                background-color: #112435;
                color: #ebebec;
            }

            .fuListBig {
                padding: 9px 0;
                border-top: 1px solid #112435;
                border-bottom: 1px solid #0d1c29;
            }

            .fuListBig li {
                position: relative;
                border-left: 4px solid #112435;
                text-indent: 42px;
                height: 40px;
                line-height: 40px;
            }

            .writeLetter:before {
                content: "";
                position: absolute;
                top: 12px;
                left: 20px;
                display: inline;
                width: 15px;
                height: 16px;
                background: url(../images/list-1.png) no-repeat;
            }

            .collectLetter:before {
                content: "";
                position: absolute;
                top: 12px;
                left: 20px;
                display: inline;
                width: 15px;
                height: 16px;
                background: url(../images/list-2.png) no-repeat;
            }

            .address:before {
                content: "";
                position: absolute;
                top: 12px;
                left: 20px;
                display: inline;
                width: 15px;
                height: 16px;
                background: url(../images/list-3.png) no-repeat;
            }

            .fuListSmall {
                font-size: 14px;
                line-height: 40px;
                color: #8f979f;
            }

            .fuListSmall li {
                position: relative;
                border-left: 4px solid #112435;
                text-indent: 42px;
            }

            .fuListSmall .hover {
                color: #b44861;
                background-color: #0f202f;
                border-color: #0f202f;
            }

            .fuListSmall .active {
                color: #b44861;
                background-color: #0f202f;
                border-color: #e15671;
            }

            .inbox:before {
                content: "";
                position: absolute;
                top: 15px;
                left: 20px;
                display: inline;
                width: 15px;
                height: 14px;
                background: url(../images/list-4.png) no-repeat;
            }

            .StarMail:before {
                content: "";
                position: absolute;
                top: 13px;
                left: 20px;
                display: inline;
                width: 15px;
                height: 15px;
                background: url(../images/list-5.png) no-repeat;
            }

            .groupMail:before {
                content: "";
                position: absolute;
                top: 13px;
                left: 20px;
                display: inline;
                width: 15px;
                height: 15px;
                background: url(../images/list-6.png) no-repeat;
            }

            .draftBox:before {
                content: "";
                position: absolute;
                top: 13px;
                left: 20px;
                display: inline;
                width: 15px;
                height: 15px;
                background: url(../images/list-7.png) no-repeat;
            }

            .beenSent:before {
                content: "";
                position: absolute;
                top: 13px;
                left: 20px;
                display: inline;
                width: 15px;
                height: 15px;
                background: url(../images/list-8.png) no-repeat;
            }

            .beenDel:before {
                content: "";
                position: absolute;
                top: 13px;
                left: 20px;
                display: inline;
                width: 15px;
                height: 15px;
                background: url(../images/list-9.png) no-repeat;
            }

            .dustbin:before {
                content: "";
                position: absolute;
                top: 12px;
                left: 20px;
                display: inline;
                width: 15px;
                height: 15px;
                background: url(../images/list-10.png) no-repeat;
            }

            .clearBtn {
                position: absolute;
                right: 19px;
                top: 0;
                color: #8f979f;
            }

            /*tBody css*/
            .tBody {
                width: 785px;
            }

            .title {
                padding-left: 22px;
                padding-top: 7px;
                height: 40px;
                line-height: 40px;
                color: #585858;
            }

            .title a {
                color: #46accd;
            }

            .emailFunctions {
                padding: 8px 20px;
                height: 24px;
                background-color: #f2f5f8;
            }

            .emailFunctions a {
                float: left;
                margin-left: 8px;
                border: 1px solid #d1d9df;
                border-radius: 3px;
                height: 22px;
                padding: 0 13px;
                font-size: 14px;
                line-height: 22px;
                background-color: #fff;
                color: #242424;
            }

            .emailFunctions a:nth-of-type(1) {
                padding: 0 17px;
                border-color: #6cb9d4;
                background-color: #6cb9d4;
                color: #f0f7fa;
            }

            .emailFunctions a:nth-of-type(3),
            .emailFunctions a:nth-of-type(4) {
                padding: 0 17px;
            }

            .emailFunctions .selectIcon {
                position: relative;
                padding-right: 32px;
            }

            .selectIcon:after {
                content: "";
                display: inline;
                position: absolute;
                top: 8px;
                right: 9px;
                width: 11px;
                height: 6px;
                background: url(../images/emailHead.png) no-repeat;
            }

            .emailHead {
                position: relative;
                padding: 10px 46px 0;
                height: 35px;
            }

            .emailHead input {
                position: absolute;
                top: 10px;
                left: 20px;
                width: 16px;
                height: 16px;
            }

            .emailHead p {
                height: 100%;
            }

            .emailHead p span {
                float: left;
                width: 20px;
                height: 16px;
                margin-left: 8px;
            }

            .emailHead p span:nth-of-type(1) {
                background: url(../images/emailHead1.png) no-repeat;
            }

            .emailHead p span:nth-of-type(2) {
                background: url(../images/emailHead2.png) no-repeat;
            }

            .emailListUl li {
                position: relative;
                padding-left: 46px;
                padding-right: 20px;
                height: 65px;
                border-top: 1px solid #e0e9f0;
            }

            .emailListUl li div {
                padding-top: 9px;
                height: 24px;
                line-height: 24px;
                font-size: 14px;
                color: #6f6f6f;
            }

            .emailListUl li span:nth-of-type(2) {
                float: right;
                height: 24px;
                line-height: 24px;
                font-size: 12px;
                color: #b4b4b4;
            }

            .emailListUl input {
                position: absolute;
                top: 14px;
                left: 20px;
                width: 16px;
                height: 16px;
            }

            .emailListUl li p {
                font-size: 12px;
                line-height: 22px;
                color: #a6a6a6;
            }

            .emailListUl li:hover {
                background-color: #f2f6f9;
            }

            .emailList .active {
                background-color: #f2f6f9;
            }

            #hint3 {
                position: absolute;
                top: 0;
                left: 0;
                padding: 0 11px;
                height: 22px;
                width: 70px;
                text-align: center;
                border: 1px solid #7d7d7d;
                border-radius: 3px;
                font-size: 12px;
                line-height: 22px;
                background-color: rgba(0, 0, 0, .7);
                color: #d4d5d5;
                display: -none;
            }
        </style>
    </head>
    <body>
        <div class="wrap" id="box">
            <header class="head clear">
                <h1 class="left">
                    <a class="logo" href="javascript:;"></a>
                    |
                    <a href="javascript:;">邮箱</a>
                </h1>
                <nav class="left">
                    <a href="javascript:;">邮箱首页</a>|<a href="javascript:;">设置</a>
                </nav>
                <p class="hint1 left"></p>
                <p class="hint2 left"></p>
            </header>
            <div class="section clear">
                <div class="fuList left">
                    <ul class="fuListBig">
                        <li class="writeLetter">写信</li>
                        <li class="collectLetter">收信</li>
                        <li class="address">通讯录</li>
                    </ul>
                    <ul class="fuListSmall">
                        <li class="inbox active">收件箱</li>
                        <li class="StarMail">星标邮件</li>
                        <li class="groupMail">群邮件</li>
                        <li class="draftBox">草稿箱</li>
                        <li class="beenSent">已发送</li>
                        <li class="beenDel hover">已删除<a class="clearBtn" href="#">清空</a></li>
                        <li class="dustbin">垃圾箱<a class="clearBtn" href="#">清空</a></li>
                    </ul>
                </div>
                <div class="tBody left">
                    <div class="title">
                        收件箱(共96封,其中<a href="javascript:;">未读邮件</a>9封)
                    </div>
                    <div class="emailFunctions">
                        <a id="delet" href="javascript:;">删除</a>
                        <a href="javascript:;">彻底删除</a>
                        <a href="javascript:;">转发</a>
                        <a href="javascript:;">举报</a>
                        <a href="javascript:;">全部标为已读</a>
                        <a class="selectIcon" href="javascript:;">标记为...</a>
                        <a class="selectIcon" href="javascript:;">移动到...</a>
                    </div>
                    <div class="emailList" id="emailCheckList">
                        <header class="emailHead">
                            <input type="checkbox"/>
                            <p><span></span><span></span></p>
                        </header>
                        <ul class="emailListUl">
                            <!-- <li>
                                <input type="checkbox">
                                <div>
                                    <span>秒味课堂1</span>
                                    <span>2015-12-30</span>
                                </div>
                                <p>JS拖拽的进一步学习,移动与拉伸JS拖拽的进一步练习</p>
                                </li> -->
                        </ul>
                    </div>
                </div>

            </div>
        </div>
        <div id="hint3" style="display:none;">选中2封邮件</div>
    </body>
    <script src="../currency/data.js"></script>
    <script src="../currency/utils.js"></script>
    <script>
        //数组下的一个方法 map

        var html = list.map(function (item) {
            return `
                    <li>
                        <input type="checkbox" data-id="${item.id}">
                        <div>
                            <span>${item.caption}</span>
                            <span>${item.time}</span>
                        </div>
                        <p>${item.desc}</p>
                    </li>
                    `
        }).join('');

        var emailListUl = document.querySelector('.emailListUl');

        emailListUl.innerHTML = html;

        //全选的按钮
        var checkboxAll = document.querySelector('.emailHead input');
        //找到所有的单选按钮
        var checkboxSingle = emailListUl.querySelectorAll('input');

        var singlesLen = checkboxSingle.length;
        //点击全选按钮
        checkboxAll.onclick = function () {
            for (var i = 0; i < singlesLen; i++) {
                checkboxSingle[i].checked = this.checked;
                //如果全选被选中了，所有的input父级li背景颜色为f2f6f9
                if (this.checked) {
                    checkboxSingle[i].parentNode.style.background = '#f2f6f9';
                } else {
                    checkboxSingle[i].parentNode.style.background = '';
                }
            }
        };
        //给每一个单选绑定点击
        for (var j = 0; j < singlesLen; j++) {
            checkboxSingle[j].onclick = function () {
                //如果当前点击的这个单选按钮，不选中，全选按钮应该也不选中
                if (!this.checked) {
                    checkboxAll.checked = false;
                    this.parentNode.style.background = '';
                } else { //选中
                    //如果这个单选的input选中了，看一下其他的input是否都选中，
                    //如果都选中，全选的按钮应该也被选中，
                    var n = 0;
                    for (var k = 0; k < singlesLen; k++) {
                        //看一下每一个input是否都选中了
                        if (checkboxSingle[k].checked) {
                            n++;
                        }
                    }
                    //for循环结束后，就可以知道input是否都选中了
                    if (n == singlesLen) {
                        checkboxAll.checked = true;
                    }

                    //选中的话就让选中的input父级li，背景为#f2f6f9
                    this.parentNode.style.background = '#f2f6f9';
                }
            };
            checkboxSingle[j].onmousedown = function (ev) {
                //阻止冒泡
                ev.stopPropagation();
            }
        }

        //用来获取那些选中的input
        function whoSelected() {
            var arr = [];
            for (var i = 0; i < singlesLen; i++) {
                if (checkboxSingle[i].checked) arr.push(checkboxSingle[i])
            }
            return arr;
        }

        //删除的按钮
        var delet = document.querySelector('#delet');

        delet.onclick = function () {
            //被选中的input父级li结构
            sc();
        };
        function sc() {

            var selectArr = whoSelected();//获取选中的input

            //删除选中的input父级li的结构
            for (var j = 0; j < selectArr.length; j++) {
                selectArr[j].parentNode.remove();//删除被选中的input父级li
                console.log(selectArr[j].dataset.id);
                //需要删除对应id的那条数据
                for (var i = 0; i < list.length; i++) {
                    if (list[i].id == selectArr[j].dataset.id) {//判断id等不等于选中的id
                        //删除数据中的id
                        list.splice(i, 1);
                    }
                }
                console.log(list)
            }
        }

        //在某一个limousedown的时候，让小tip出现
        var tip = document.querySelector('#hint3');

        //拿到所有的li
        var lis = emailListUl.querySelectorAll('li');
        var beenDel=document.querySelector('.beenDel');
        for (var j = 0; j < lis.length; j++) {
            lis[j].onmousedown = function (ev) {
                //看一下这个li下面的input，是否是选中的
                var input=this.querySelector('input');

                if(!input.checked){
                    return;
                }

                var selectArr=whoSelected();

                var isCollision=false;//默认没有碰上

                tip.style.display = 'block';
                tip.style.left = ev.clientX + 1 + 'px';
                tip.style.top = ev.clientY + 1 + 'px';
                tip.innerText=`选中${selectArr.length}封邮件`;

                document.onmousemove = function (ev) {
                    tip.style.left = ev.clientX + 'px';
                    tip.style.top = ev.clientY + 'px';

                    //需要判断一下是否和“已删除”这一项碰上了
                    //碰撞检测
                    if(collision(tip,beenDel)){
                        //console.log('碰上了')
                        isCollision=true;
                    }

                    //取消默认行为
                    ev.preventDefault();
                };

                document.onmouseup = function (ev) {
                    tip.style.display = 'none';
                    //知道是否碰上了
                    if(isCollision){
                        //删除结构和数据
                        sc();
                    }
                    document.onmousemove=document.onmouseup=null;
                }
            }
        }

    </script>

</html>

